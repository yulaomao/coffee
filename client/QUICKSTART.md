# 咖啡机客户端快速开始指南

## 概述

这是一个基于Python+Flask的咖啡机客户端应用，提供了现代化的触摸屏Web界面，用于控制和监控咖啡机设备。

## 功能特性

### 🎯 核心功能
- **咖啡制作控制**: 支持多种咖啡类型（意式浓缩、美式、拿铁等）
- **实时状态监控**: 温度、水位、压力等传感器数据实时显示
- **硬件控制**: 研磨机、水泵、加热器、蒸汽等组件控制
- **远程通信**: 与管理后台的HTTP API和WebSocket通信

### 🎨 用户界面
- **响应式设计**: 适配各种屏幕尺寸，触摸屏优化
- **现代化UI**: Bootstrap 5 + 自定义主题，美观易用
- **实时更新**: WebSocket实现的实时状态推送
- **多语言支持**: 支持中文简体（可扩展其他语言）

### 🔧 技术特性
- **模拟模式**: 无需实际硬件即可演示所有功能
- **硬件抽象**: 支持GPIO控制和模拟接口
- **配置管理**: JSON配置文件，支持运行时修改
- **日志系统**: 完整的日志记录和错误处理

## 快速开始

### 1. 环境准备

```bash
# 克隆仓库（如果还没有）
git clone <repository-url>
cd coffee/client

# 创建虚拟环境（推荐）
python -m venv venv
source venv/bin/activate  # Linux/Mac
# 或 venv\Scripts\activate  # Windows

# 安装依赖
pip install -r requirements.txt
```

### 2. 配置设备

编辑配置文件：
```bash
# 编辑设备配置
vim config/device.json

# 编辑默认配置（可选）
vim config/default.json
```

### 3. 运行应用

```bash
# 运行客户端应用
python run.py

# 指定端口运行
python run.py 0.0.0.0 5001

# 调试模式运行
python run.py --debug
```

### 4. 访问界面

打开浏览器访问：`http://localhost:5001`

## 演示模式

如果您想快速体验功能，可以运行演示脚本：

```bash
# 运行交互式演示
python demo.py
```

演示包括：
- 配置系统展示
- 硬件模拟演示
- 咖啡制作流程
- API客户端功能
- Web界面介绍

## 界面介绍

### 主界面 (`/`)
- **状态仪表盘**: 显示温度、水位、压力等实时数据
- **制作状态**: 当前咖啡制作进度和步骤
- **快捷操作**: 常用功能按钮
- **连接状态**: API和WebSocket连接状态

### 咖啡选择 (`/coffee`)
- **咖啡类型**: 可用咖啡类型展示
- **参数自定义**: 调整研磨时间、水量、温度等
- **快速制作**: 使用默认参数制作
- **自定义制作**: 使用个性化参数

### 制作过程 (`/making`)
- **进度显示**: 实时制作进度条
- **当前步骤**: 显示正在执行的制作步骤
- **实时数据**: 温度、压力等传感器数据
- **取消功能**: 中断当前制作过程

### 设置界面 (`/settings`)
- **基本设置**: 界面主题、语言、声音等
- **网络设置**: 服务器地址、API密钥配置
- **维护设置**: 自动清洗、除垢提醒等
- **设备信息**: 设备状态和系统信息

### 管理界面 (`/admin`)
- **系统状态**: CPU、内存使用情况
- **硬件测试**: 各组件功能测试
- **连接诊断**: 网络连接状态检查
- **系统控制**: 重启、维护等操作

## 配置说明

### 设备配置 (`config/device.json`)
```json
{
    "device_no": "DEMO-CLIENT-001",
    "api_key": "your-api-key",
    "registered": false,
    "server_url": "http://localhost:5000"
}
```

### 默认配置 (`config/default.json`)
主要包含：
- 硬件配置（GPIO引脚、传感器设置）
- 咖啡配方（各种咖啡的默认参数）
- UI配置（主题、语言、界面设置）
- 维护配置（清洗间隔、提醒设置）
- 服务器通信配置

## 模拟模式

应用默认运行在模拟模式下，这意味着：
- 所有硬件操作都是模拟的
- 传感器数据由算法生成
- 制作过程完全仿真
- 无需实际咖啡机硬件

要切换到真实硬件模式：
```json
{
    "hardware": {
        "simulation_mode": false,
        "gpio_pins": {
            "water_pump": 18,
            "grinder": 19,
            "heater": 20,
            "steam_valve": 21
        }
    }
}
```

## 与后台集成

### API通信
客户端会定期与管理后台通信：
- **心跳**: 每30秒发送一次
- **状态上报**: 每5分钟上报详细状态
- **命令轮询**: 每10秒检查待执行命令

### WebSocket连接
实时通信功能：
- **状态推送**: 实时状态变化通知
- **命令接收**: 远程控制命令
- **事件广播**: 重要事件通知

### 认证流程
1. 使用API密钥认证HTTP请求
2. WebSocket使用相同密钥建立连接
3. 支持设备注册和自动获取密钥

## 开发说明

### 项目结构
```
client/
├── app/                    # 应用核心代码
│   ├── core/              # 核心控制逻辑
│   ├── api/               # API通信模块
│   ├── web/               # Web界面模块
│   ├── static/            # 静态资源
│   └── templates/         # HTML模板
├── config/                # 配置文件
├── logs/                  # 日志目录
├── run.py                 # 启动脚本
└── demo.py               # 演示脚本
```

### 扩展开发
- **添加新咖啡类型**: 在配置文件中定义新的配方
- **硬件驱动**: 继承`HardwareInterface`实现新的硬件支持
- **UI主题**: 修改CSS变量创建新主题
- **语言支持**: 添加国际化支持文件

## 故障排除

### 常见问题

**Q: 应用启动失败**
- 检查Python版本（需要3.7+）
- 确认依赖已正确安装
- 查看日志文件了解具体错误

**Q: WebSocket连接失败**
- 检查防火墙设置
- 确认服务器地址配置正确
- 查看浏览器控制台错误信息

**Q: 硬件测试无响应**
- 确认运行在模拟模式下
- 检查GPIO权限（真实硬件模式）
- 查看应用日志了解详细错误

### 日志查看
```bash
# 查看应用日志
tail -f logs/client.log

# 查看特定级别日志
grep ERROR logs/client.log
```

## 技术支持

- **文档**: 参考项目README和代码注释
- **演示**: 运行`python demo.py`了解各功能模块
- **调试**: 使用`--debug`参数运行查看详细信息

## 版本信息

- **当前版本**: v1.0.0
- **Python要求**: 3.7+
- **浏览器要求**: 支持HTML5和WebSocket的现代浏览器